<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>View Bug | Bug Tracker</title>
    <link rel="stylesheet" th:href="@{/css/bug-style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
</head>
<body>

    <div th:replace="fragments/sidebar :: sidebar"></div>

    <div class="main-content">
        <h1>Bug Details</h1>

        <div class="card p-4 shadow-sm">
            <p><strong>ID:</strong> <span th:text="${bug.id}"></span></p>
            <p><strong>Title:</strong> <span th:text="${bug.title}"></span></p>
            <p><strong>Description:</strong> <span th:text="${bug.description}"></span></p>
            <p><strong>Priority:</strong> <span th:text="${bug.priority}"></span></p>
            <p><strong>Status:</strong> <span th:text="${bug.status}"></span></p>
            <p><strong>Assigned To:</strong>
                <span th:text="${bug.assignedToUsername != null ? bug.assignedToUsername : 'Unassigned'}"></span>
            </p>
            <p><strong>Reported By:</strong> <span th:text="${bug.createdBy}"></span></p>
        </div>

        <div class="mt-3">
            <a th:href="@{/bugs}" class="btn btn-secondary">Back to Bugs</a>

            <span th:if="${#authorization.expression('hasRole(''ADMIN'')}">
                <a th:href="@{/bugs/edit/{id}(id=${bug.id})}" class="btn btn-warning">Edit</a>
                <a th:href="@{/bugs/delete/{id}(id=${bug.id})}" 
                   class="btn btn-danger"
                   onclick="return confirm('Delete this bug?')">Delete</a>
            </span>

            <span th:if="${#authorization.expression('hasRole(''DEVELOPER'')')}">
                <a th:if="${bug.assignedToUsername == principal.username}" 
                   th:href="@{/bugs/edit/{id}(id=${bug.id})}" 
                   class="btn btn-warning">Edit</a>
            </span>

            <span th:if="${bug.createdBy == principal.username}">
                <a th:href="@{/bugs/edit/{id}(id=${bug.id})}" class="btn btn-warning">Edit</a>
            </span>
        </div>
    </div>

</body>
</html>
